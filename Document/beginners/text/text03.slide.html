<!DOCTYPE html>
<html lang="ja">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
<meta content="Asciidoctor 1.5.8" name="generator" />
<meta content="この文書は、技術教育「要素技術とモデルを開発に使おう」に使用するETロボコン公式トレーニングのテキストです。" name="description" />
<meta content="ETロボコン実行委員会" name="author" />
<title>要素技術とモデルを開発に使おう: 倒立振子ライブラリをモデルに組込もう</title>
<link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet" />
<style>
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 1.2em; height: 1.2em; font-size: 0.9em; font-weight: bold; line-height: 1.2; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -0.1em; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.colist table td:first-of-type { padding-right: 0.25em; }
</style>
<link href="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css" rel="stylesheet" />
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
<link href="deck.js/core/deck.core.css" rel="stylesheet" />
<link href="deck.js/extensions/scale/deck.scale.css" media="screen" rel="stylesheet" />
<link href="deck.js/extensions/goto/deck.goto.css" media="screen" rel="stylesheet" />
<link href="deck.js/extensions/menu/deck.menu.css" media="screen" rel="stylesheet" />
<link href="deck.js/extensions/navigation/deck.navigation.css" media="screen" rel="stylesheet" />
<link href="deck.js/extensions/status/deck.status.css" media="screen" rel="stylesheet" />
<link href="deck.js/themes/style/mystyle.css" media="screen" rel="stylesheet" />
<link href="deck.js/themes/transition/fade.css" media="screen" rel="stylesheet" />
<link href="deck.js/core/print.css" media="print" rel="stylesheet" />
<script src="deck.js/modernizr.custom.js"></script>
</head>
<body class="article">
<div class="deck-container">
<section class="slide" id="title-slide">
<h1>要素技術とモデルを開発に使おう: 倒立振子ライブラリをモデルに組込もう</h1>
<span id="author">ETロボコン実行委員会</span>
<br />
<span id="email"><a href="mailto:er-info@etrobo.jp">er-info@etrobo.jp</a></span>
<br />
<span id="revnumber"> 2.3,</span>
<span id="revdate">2019-04-12 16:47:00</span>
<br />
<span id="revremark">2019年用</span>
</section>
<section class="slide" id="_倒立振子用に走行体を変更する">
<h2>倒立振子用に走行体を変更する</h2>
<div class="paragraph"><p>この演習では、倒立振子ライブラリを使って倒立走行させますので、これまで装着していた <strong>「トレーニング用補助脚」</strong> を外します。</p></div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img alt="トレーニング用補助脚を外した走行体" src="images/EV3way-ET18_s.png" width="50%" />
</div>
<div class="title">図 1. トレーニング用補助脚を外した走行体</div>
</div>
<div class="openblock">
<div class="title"><code>HackEV</code> を使っている場合:</div>
<div class="content">
<div class="paragraph"><p><code>settings_for_HackEV_user.pdf</code> の <strong>「倒立振子ライブラリを使うふりをする」</strong> をするを参照して、<strong>あたかも倒立振子が必要なシステムのように</strong> 振る舞うよう、ダミーの <code>balance_control</code> 関数を追加します。</p></div>
</div>
</div>
</section>
<section class="slide" id="_sample_c4倒立振子のサンプルを試す">
<h2>sample_c4（倒立振子のサンプル）を試す</h2>
<div class="paragraph"><p>倒立振子を使ったサンプル <code>sample_c4</code> を動かしてみましょう。</p></div>
<div class="paragraph">
<div class="title"><code>sample_c4</code> は、次のサイトから入手できます:</div><p><a href="https://github.com/ETrobocon/etroboEV3/tree/master/SampleCode/EV3way_EV3RT_sample">GitHubのetroboEV3のページ</a></p></div>
<div class="paragraph"><p>配布物にも入手して含めてありますので、そちらを使うとよいでしょう。</p></div>
<div class="olist arabic">
<div class="title">次の手順でビルドします:</div>
<ol class="arabic">
<li>
<code>sample_c4</code> フォルダを、EV3RTインストールディレクトリの <code>hrp2/sdk/beginners</code> の中にコピーします
</li>
<li>
<p>コピーしたら、コピー先のディレクトリの内容を確認しましょう</p>
<div class="listingblock">
<div class="content">
<pre class="prettyprint console language-console"><code>$ cd (ev3rtのインストールディレクトリ）/hrp2/sdk/beginners&#x000A;$ ls&#x000A;Makefile  sample00/  sample01/  sample03/  sample04/  sample05/  sample_c4/&#x000A;&#x000A;$ ls sample_c4&#x000A;Makefile.inc  app.c  app.cfg  app.h  balancer.c  balancer.h  balancer_param.c  balancer_private.h</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always"></div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p><code>beginners</code> ディレクトリでビルドします</p>
<div class="listingblock">
<div class="content">
<pre class="prettyprint console language-console"><code>$ cd hrp2/sdk/beginners&#x000A;$ make app=sample_c4</code></pre>
</div>
</div>
</li>
<li>
ビルドに成功すると <code>app</code> という実行ファイルが生成されます
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">実行する手順は次の通りです:</div>
<ol class="arabic">
<li>
プログラムをEV3本体に転送します
</li>
<li>
尻尾を一番上に向けてプログラムを起動します
</li>
<li>
尻尾が完全停止位置に動きます
</li>
<li>
画面に「EV3way-ET sample_c4」と表示されます
</li>
<li>
走行体をラインの左エッジに配置します
</li>
<li>
タッチセンサーを押すと走行を開始します
</li>
<li>
走行を終了するには、EV3本体の「Back」ボタンを押します
</li>
</ol>
</div>
</section>
<section class="slide" id="_sample_c4の構造をクラス図に表す">
<h2>sample_c4の構造をクラス図に表す</h2>
<div class="paragraph"><p><strong>astah* </strong> で「sample_c4」プロジェクトを作成し、 <code>sample_c4</code> のコードをクラス図を使って整理してみましょう。</p></div>
<div class="ulist">
<div class="title">次のような方針でクラス図を使った図に直してみます</div>
<ul>
<li>ev3apiの関数群は「ev3api」クラスのメソッドと考えてクラスにまとめます</li>
<li><code>main_task</code> はクラスではありませんが、この演習ではクラスを使って表すことにします<br />
（この演習では <code>bt_task</code> については気にしないでおきます）</li>
<li><code>app.c</code> で定義している他の関数は <code>app</code> クラスのメソッドと考えましょう</li>
<li><code>balance_init</code> と <code>balance_control</code> は <code>balancer</code> クラスのメソッドと考えましょう</li>
<li>グローバルは定数や変数は <code>app</code> クラスの属性と捉えることができますが、今回の作図では割愛しましょう</li>
</ul>
</div>
</section>
<section class="slide" id="_作成したsample_c4の構造を表したクラス図">
<h2>作成したsample_c4の構造を表したクラス図</h2>
<div class="imageblock" style="text-align: center">
<div class="content">
<img alt="sample c4のクラス図" src="images/sample_c4のクラス図.png" width="75%" />
</div>
<div class="title">図 2. <code>sample_c4</code> のクラス図</div>
</div>
</section>
<section class="slide" id="_倒立振子ライブラリのパラメータを調べる">
<h2>倒立振子ライブラリのパラメータを調べる</h2>
<div class="paragraph"><p>操作量を算出する関数（ <code>balance_control</code> ）のパラメータをみると、その更新時期・間隔には違いがあるのがわかります。</p></div>
<div class="paragraph"><p>これは、使う側からすると、呼び出すのと設定するのは同じタイミングでなくてもよいという意味になります。</p></div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img alt="balancer_params" src="images/balacnerのインターフェースの検討.png" width="75%" />
</div>
<div class="title">図 3. <code>balacne_control</code> のパラメータの更新タイミング</div>
</div>
</section>
<section class="slide" id="_倒立振子ライブラリの呼び出し方を考える">
<h2>倒立振子ライブラリの呼び出し方を考える</h2>
<div class="paragraph"><p>更新タイミングの違いについて、次のように整理してみました。</p></div>
<div class="ulist">
<ul>
<li><p>
<code>GYRO_OFFSET</code> は、一度だけ取得して覚えておけばよい<div class="ulist">
<ul>
<li><code>init</code> の時に渡して覚えさせておけばよさそうです</li>
</ul>
</div></p></li>
<li><p>
<code>forward</code> , <code>turn</code> は、動作を変更したい時にしか変更しない<div class="ulist">
<ul>
<li>変更時に覚えさせておけばよさそうです</li>
</ul>
</div></p></li>
<li><p>
<code>gyro</code> , <code>motor_ang_l</code> , <code>motor_ang_r</code> , <code>volt</code><div class="ulist">
<ul>
<li>4msの更新のたびに最新値を取得する必要があります</li>
</ul>
</div></p></li>
</ul>
</div>
<div class="paragraph"><p>つまり、<strong>倒立振子ライブラリのために覚えておく変数を「属性」</strong> 、 <strong>ライブラリの関数を「操作」</strong> とみなし、セットにしてクラスと考えれば、倒立振子ライブラリをクラスとして仕立てることができそうです。</p></div>
<div class="listingblock">
<div class="content">
<pre><code>では、どのようなクラスになりそうでしょうか？</code></pre>
</div>
</div>
</section>
<section class="slide" id="_整理した結果から得たbalancerクラス">
<h2>整理した結果から得たBalancerクラス</h2>
<div class="paragraph"><p>検討の結果、次のようなクラスを作ることにしました。</p></div>
<div class="paragraph"><p>属性やメソッド説明は次のページにあります。</p></div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img alt="balancer_snap" src="images/balancerクラスの図.png" width="75%" />
</div>
<div class="title">図 4. 整理した結果から得た <code>Balancer</code> クラス</div>
</div>
</section>
<section class="slide" id="_balancerクラスの説明">
<h2>Balancerクラスの説明</h2>
<div class="ulist">
<ul>
<li><p>
<code>gyro</code> , <code>motor_ang_l</code> , <code>motor_ang_r</code> , <code>volt</code> は <code>update</code> メソッドに渡します<div class="ulist">
<ul>
<li>このメソッドを呼び出すと <code>balance_contol</code> が呼び出されて操作量を計算します</li>
</ul>
</div></p></li>
<li><p>
操作量の計算結果は、属性 <code>mLeftPwm</code>、 <code>mRightPwm</code> に保存しておきます<div class="ulist">
<ul>
<li>この属性があると、クラスの利用者は、最後に <code>update</code> メソッドを呼び出した時の計算結果を <code>getPwnLeft</code> 、 <code>getPwmRight</code> メソッドを使って参照できるようになります</li>
</ul>
</div></p></li>
<li><code>GYRO_OFFSET</code> は <code>init</code> メソッドに渡して、属性に保存しておきます</li>
<li><code>forward</code>, <code>turn</code> は <code>setCommand</code> メソッドに渡して、属性に保存しておきます</li>
</ul>
</div>
</section>
<section class="slide" id="_sample_cpp4の構造をクラス図に表す">
<h2>sample_cpp4の構造をクラス図に表す</h2>
<div class="paragraph"><p>作成した <code>Balancer</code> クラスを使用したクラス図を描きましょう。</p></div>
<div class="olist arabic">
<ol class="arabic">
<li>
<code>sample_c4.asta</code> をコピーして <code>sample_cpp4.asta</code> を用意します
</li>
<li>
<code>sample_c4のクラス図</code> を <code>sample_cpp4のクラス図</code> に変更します
</li>
<li>
<code>Balancer</code> クラスを追加します。
</li>
<li>
関連を引き直します
</li>
</ol>
</div>
</section>
<section class="slide" id="_作成した_sample_cpp4のクラス図">
<h2>作成した sample_cpp4のクラス図</h2>
<div class="imageblock" style="text-align: center">
<div class="content">
<img alt="sample_cpp4" src="images/sample_cpp4のクラス図.png" width="100%" />
</div>
<div class="title">図 5. <code>Balancer</code> クラスを追加した <code>sample_cpp4</code> のクラス図</div>
</div>
</section>
<section class="slide" id="_sample_cpp4のコードを作成する準備">
<h2>sample_cpp4のコードを作成する準備</h2>
<div class="paragraph"><p>C&#43;&#43; のクラスを追加するので、コードを修正するため前に少し準備しましょう。</p></div>
<div class="olist arabic">
<ol class="arabic">
<li>
<code>sample_c4</code> ディレクトリをそのままコピーして <code>sample_cpp4</code> ディレクトリを作成します
</li>
<li>
<code>app.c</code> は、 C&#43;&#43; のコードを扱うので <code>app.cpp</code> に変更します
</li>
<li>
<code>Makefile.inc</code> を次のように編集します
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">リスト 1. <code>Makefile.inc</code> の抜粋</div>
<div class="content">
<pre class="prettyprint makefile language-makefile"><code>APPL_COBJS += balancer.o balancer_param.o&#x000A;&#x000A;APPL_CXXOBJS += BalancerCpp.o  <i class="conum" data-value="1"></i><b>(1)</b>&#x000A;&#x000A;SRCLANG := c++   <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>C&#43;&#43; オブジェクトとして <code>BalancerCpp.o</code> を追加します</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>C&#43;&#43; 用の言語設定を追加します</td>
</tr>
</table>
</div>
<div class="paragraph"><p>修正できたら、ビルドしてみて、修正前と同じように動作するか確認しておきましょう。</p></div>
</section>
<section class="slide" id="_balancercpp_hを追加する">
<h2>BalancerCpp.hを追加する</h2>
<div class="paragraph"><p><code>sample_cpp4</code> ディレクトリに <code>Balancer</code> クラスのヘッダファイルを作成します。<br />
既存の <code>balance</code> 関数のファイルと区別するため、ファイル名を <code>BalancerCpp.h</code> としました。</p></div>
<div class="listingblock">
<div class="title">リスト 2. <code>BalancerCpp.h</code> （その１）</div>
<div class="content">
<pre class="prettyprint linenums:9 cpp language-cpp"><code>#ifndef EV3_UNIT_BALANCERCPP_H_&#x000A;#define EV3_UNIT_BALANCERCPP_H_&#x000A;&#x000A;#include "ev3api.h"&#x000A;&#x000A;class Balancer {&#x000A;public:&#x000A;  Balancer();&#x000A;&#x000A;  void init(int offset);&#x000A;  void update(int angle, int rwEnc, int lwEnc, int battery);&#x000A;  void setCommand(int forward, int turn);&#x000A;  int8_t getPwmRight();&#x000A;  int8_t getPwmLeft();</code></pre>
</div>
</div>
<div style="page-break-after: always"></div>
<div class="listingblock">
<div class="title">リスト 3. <code>BalancerCpp.h</code> （その２）</div>
<div class="content">
<pre class="prettyprint linenums:24 cpp language-cpp"><code>private:&#x000A;  int mForward;&#x000A;  int mTurn;&#x000A;  int mOffset;&#x000A;  int8_t mRightPwm;&#x000A;  int8_t mLeftPwm;&#x000A;&#x000A;  void cancelBacklash(int&amp; rwEnc, int&amp; lwEnc);&#x000A;};&#x000A;&#x000A;#endif  // EV3_UNIT_BALANCERCPP_H_</code></pre>
</div>
</div>
</section>
<section class="slide" id="_balancercpp_cppを追加する">
<h2>BalancerCpp.cppを追加する</h2>
<div class="paragraph"><p><code>sample_cpp4</code> ディレクトリに <code>Balancer</code> クラスのcppファイルを作成します。<br />
既存の <code>balance</code> 関数のファイルと区別するため、ファイル名を <code>BalancerCpp.cpp</code> としました。</p></div>
<div class="listingblock">
<div class="title">リスト 4. <code>BalancerCpp.cpp</code> （その１）</div>
<div class="content">
<pre class="prettyprint linenums:9 cpp language-cpp"><code>#include "balancer.h"&#x000A;#include "BalancerCpp.h"&#x000A;&#x000A;/**&#x000A; * コンストラクタ&#x000A; */&#x000A;Balancer::Balancer()&#x000A;  : mForward(0),   mTurn(0),   mOffset(0),  mRightPwm(0),  mLeftPwm(0) {&#x000A;}&#x000A;&#x000A;/**&#x000A; * バランサーを初期化する&#x000A; * @param offset ジャイロセンサオフセット値&#x000A; */&#x000A;void Balancer::init(int offset) {&#x000A;  mOffset = offset;&#x000A;  balance_init();  // 倒立振子制御初期化&#x000A;}</code></pre>
</div>
</div>
<div style="page-break-after: always"></div>
<div class="listingblock">
<div class="title">リスト 5. <code>BalancerCpp.cpp</code> （その２）</div>
<div class="content">
<pre class="prettyprint linenums:28 cpp language-cpp"><code>/**&#x000A; * バックラッシュキャンセル&#x000A; * @note          直近のPWM値に応じてエンコーダ値にバックラッシュ分の値を追加します&#x000A; * @param rwEnc   右車輪エンコーダ値&#x000A; * @param lwEnc   左車輪エンコーダ値&#x000A; * @date          2017/10/24&#x000A; * @author        Koji SHIMIZU&#x000A; */&#x000A;void Balancer::cancelBacklash(int&amp; rwEnc, int&amp; lwEnc)&#x000A;{&#x000A;  const int BACKLASHHALF = 4;   // バックラッシュの半分[deg]&#x000A;&#x000A;  if(mRightPwm &lt; 0) rwEnc += BACKLASHHALF;&#x000A;  else if(mRightPwm &gt; 0) rwEnc -= BACKLASHHALF;&#x000A;&#x000A;  if(mLeftPwm &lt; 0) lwEnc += BACKLASHHALF;&#x000A;  else if(mLeftPwm &gt; 0) lwEnc -= BACKLASHHALF;&#x000A;}</code></pre>
</div>
</div>
<div style="page-break-after: always"></div>
<div class="listingblock">
<div class="title">リスト 6. <code>BalancerCpp.cpp</code> （その３）</div>
<div class="content">
<pre class="prettyprint linenums:47 cpp language-cpp"><code>/**&#x000A; * バランサーの値を更新する&#x000A; * @param angle   角速度&#x000A; * @param rwEnc   右車輪エンコーダー値&#x000A; * @param lwEnc   左車輪エンコーダー値&#x000A; * @param battery バッテリー電圧値&#x000A; */&#x000A;void Balancer::update(int angle, int rwEnc, int lwEnc, int battery) {&#x000A;  cancelBacklash(lwEnc, rwEnc); // バックラッシュキャンセル&#x000A;  // 倒立振子制御APIを呼び出し、倒立走行するための&#x000A;  // 左右モーター出力値を得る&#x000A;  balance_control (&#x000A;     static_cast&lt;float&gt;(mForward),&#x000A;     static_cast&lt;float&gt;(mTurn),&#x000A;     static_cast&lt;float&gt;(angle),&#x000A;     static_cast&lt;float&gt;(mOffset),&#x000A;     static_cast&lt;float&gt;(lwEnc),&#x000A;     static_cast&lt;float&gt;(rwEnc),&#x000A;     static_cast&lt;float&gt;(battery),&#x000A;     &amp;mLeftPwm,&#x000A;     &amp;mRightPwm);&#x000A;}</code></pre>
</div>
</div>
<div style="page-break-after: always"></div>
<div class="listingblock">
<div class="title">リスト 7. <code>BalancerCpp.cpp</code> （その４）</div>
<div class="content">
<pre class="prettyprint linenums:70 cpp language-cpp"><code>/**&#x000A; * 前進値、旋回値を設定する&#x000A; * @param forward 前進値&#x000A; * @param turn    旋回値&#x000A; */&#x000A;void Balancer::setCommand(int forward, int turn) {&#x000A;  mForward = forward;&#x000A;  mTurn    = turn;&#x000A;}&#x000A;&#x000A;/**&#x000A; * 右車輪のPWM値を取得する&#x000A; * @return 右車輪のPWM値&#x000A; */&#x000A;int8_t Balancer::getPwmRight() {&#x000A;  return mRightPwm;&#x000A;}&#x000A;&#x000A;/**&#x000A; * 左車輪のPWM値を取得する&#x000A; * @return 左車輪のPWM値&#x000A; */&#x000A;int8_t Balancer::getPwmLeft() {&#x000A;  return mLeftPwm;&#x000A;}</code></pre>
</div>
</div>
</section>
<section class="slide" id="_app_cppを修正する">
<h2>app.cppを修正する</h2>
<div class="paragraph"><p>作成した <code>Balancer</code> クラスを使って、 <code>app.cpp</code> のコードを修正しましょう</p></div>
<div class="listingblock">
<div class="title">リスト 8. <code>app.cpp</code> （抜粋その１）</div>
<div class="content">
<pre class="prettyprint linenums:68 cpp language-cpp"><code>/* 関数プロトタイプ宣言 */&#x000A;static int sonar_alert(void);&#x000A;static void tail_control(signed int angle);&#x000A;&#x000A;#include "BalancerCpp.h"        <i class="conum" data-value="1"></i><b>(1)</b>&#x000A;Balancer balancer;              <i class="conum" data-value="1"></i><b>(1)</b>&#x000A;&#x000A;/* メインタスク */&#x000A;void main_task(intptr_t unused)&#x000A;{</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>追加した <code>Balancer</code> クラスのインスタンスを作成しています</td>
</tr>
</table>
</div>
<div style="page-break-after: always"></div>
<div class="listingblock">
<div class="title">リスト 9. <code>app.cpp</code> （抜粋その２）</div>
<div class="content">
<pre class="prettyprint linenums:129 cpp language-cpp"><code>/* ジャイロセンサーリセット */&#x000A;  ev3_gyro_sensor_reset(gyro_sensor);&#x000A;  balancer.init(GYRO_OFFSET);                <i class="conum" data-value="1"></i><b>(1)</b>&#x000A;&#x000A;  ev3_led_set_color(LED_GREEN); /* スタート通知 */</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Balancer</code> クラスの <code>init</code> メソッドを呼び出しています<br />
（GYRO_OFFSETを渡しています）</td>
</tr>
</table>
</div>
<div style="page-break-after: always"></div>
<div class="listingblock">
<div class="title">リスト 10. <code>app.cpp</code> （抜粋その３）</div>
<div class="content">
<pre class="prettyprint linenums:164 cpp language-cpp"><code>/* 倒立振子制御API に渡すパラメータを取得する */&#x000A;      motor_ang_l = ev3_motor_get_counts(left_motor);&#x000A;      motor_ang_r = ev3_motor_get_counts(right_motor);&#x000A;      gyro = ev3_gyro_sensor_get_rate(gyro_sensor);&#x000A;      volt = ev3_battery_voltage_mV();&#x000A;&#x000A;      /* 倒立振子制御APIを呼び出し、倒立走行するための */&#x000A;      /* 左右モータ出力値を得る */&#x000A;      balancer.setCommand(forward, turn);   <i class="conum" data-value="1"></i><b>(1)</b>&#x000A;      balancer.update(gyro, motor_ang_r, motor_ang_l, volt); <i class="conum" data-value="2"></i><b>(2)</b>&#x000A;      pwm_R = balancer.getPwmRight();       <i class="conum" data-value="3"></i><b>(3)</b>&#x000A;      pwm_L = balancer.getPwmLeft();        <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>走行の指示として、前進値 <code>forward</code> と, 旋回値 <code>turn</code> を設定しています<br />
（ここでは元のプログラムの構造上毎回呼んでいますが、本来は走行指示に変更があった時だけ呼べばよいはずです）</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>センサーの最新値をbalancerライブラリへ渡して、操作量を再計算しています</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>算出した操作量をモーターに渡す変数に設定しています</td>
</tr>
</table>
</div>
<div class="paragraph"><p>修正が済んだら、ビルドして、動作を確認しましょう。</p></div>
</section>
<section class="slide" id="_ここまでのまとめ">
<h2>ここまでのまとめ</h2>
<div class="paragraph"><p>要素技術を検討して得られたC言語で作成した既存のライブラリ（この演習では倒立振子ライブラリ）をシステムのモデルに組込むため、クラスに仕立てる方法を演習しました。</p></div>
<div class="ulist">
<ul>
<li>パラメータの更新機会に着目して、同時に必要なものをまとめました</li>
<li>更新機会が少ないパラメータは、クラスの属性に保持することで覚えておけます</li>
<li>更新機会に応じてメソッドを分けることで、一度の呼び出に必要なパラメータを減らすことができます</li>
<li>パラメータを属性に保持することで、メソッドのインターフェースが必要最小限に抑えられます</li>
</ul>
</div>
</section>
<section class="slide" id="_トレーニングのまとめ">
<h2>トレーニングのまとめ</h2>
<div class="paragraph"><p>このトレーニングでは、モデルとコードの対応づけ、要素技術をモデル図に反映する方法について演習しました。</p></div>
<div class="olist arabic">
<ol class="arabic">
<li>
コードのありのままの状況を整理するのにもモデル図が使えることがわかりました
</li>
<li>
<p>モデルとコードを対応づけていれば、双方向に利用できることがわかりました</p>
<div class="ulist">
<ul>
<li>モデルで考えることもコードから設計（モデル）に戻って検討することもできます</li>
</ul>
</div>
</li>
<li>
要素技術を利用するときは、実験と組込みを区別して考えましょう
</li>
<li>
<p>要素技術をシステムに組込むには、モデル図の要素としての名前（クラスや操作など）をつけて、モデル図から読み取れるようにしましょう</p>
<div class="ulist">
<ul>
<li>倒立振子ライブラリも要素技術のひとつとして、モデル図に組み込めることがわかりました</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph"><p>このトレーニングの結果を活かして、より見通しのよいシステムやモデル図が作成できるようになることを期待しています。</p></div>
</section>
<section class="slide" id="end_of_chapter">
<h2>本資料について</h2>
<div class="paragraph"><p>資料名： 要素技術とモデルを開発に使おう: 倒立振子ライブラリをモデルに組込もう （技術教育資料）<br />
作成者： &#169; 2016,2017,2018,2019 by ETロボコン実行委員会<br />
この文書は、技術教育「要素技術とモデルを開発に使おう」に使用するETロボコン公式トレーニングのテキストです。</p></div>
<div class="paragraph"><p>2.3, 2019-04-12 16:47:00, 2019年用</p></div>
</section>
<div aria-role="navigation">
<a class="deck-prev-link" href="#" title="Previous">&#8592;</a>
<a class="deck-next-link" href="#" title="Next">&#8594;</a>
</div>
<p aria-role="status" class="deck-status">
<span class="deck-status-current"></span>
/
<span class="deck-status-total"></span>
</p>
<form action="." class="goto-form" method="get">
<label for="goto-slide">Go to Slide:</label>
<input id="goto-slide" list="goto-datalist" name="slidenum" type="text" />
<datalist id="goto-data-list"></datalist>
<input type="submit" value="Go" />
</form>
</div>
<script src="deck.js/jquery.min.js"></script>
<script src="deck.js/core/deck.core.js"></script>
<script src="deck.js/extensions/scale/deck.scale.js"></script>
<script src="deck.js/extensions/goto/deck.goto.js"></script>
<script src="deck.js/extensions/menu/deck.menu.js"></script>
<script src="deck.js/extensions/navigation/deck.navigation.js"></script>
<script src="deck.js/extensions/split/deck.split.js"></script>
<script src="deck.js/extensions/status/deck.status.js"></script>
<script type="text/javascript">
  //<![CDATA[
    (function($, deck, undefined) {
      $.deck.defaults.keys['previous'] = [8, 33, 37, 39];
      $.deck.defaults.keys['next'] = [13, 32, 34, 39];
    
      $.extend(true, $[deck].defaults, {
          countNested: false
      });
    
      $.deck('.slide');
    })(jQuery, 'deck');
  //]]>
</script>
<style type="text/css">
  /*<![CDATA[*/
    .slide.canvas-image {
    -moz-background-size: cover;
    -webkit-background-size: cover;
    -o-background-size: cover;
    background-size: cover;
    display: -moz-box;
    display: -webkit-box;
    display: -ms-box;
    display: box;
    -moz-box-orient: vertical;
    -webkit-box-orient: vertical;
    -ms-box-orient: vertical;
    box-orient: vertical;
    -moz-box-align: start;
    -webkit-box-align: start;
    -ms-box-align: start;
    box-align: start;
    -moz-box-pack: start;
    -webkit-box-pack: start;
    -ms-box-pack: start;
    box-pack: start;}
    
    .bottom-left {
      left: 1%;
      bottom: 20%; }
    
    .top-left {
      left: 1%;
      top: 20%; }
    
    .bottom-right {
      right: 1%;
      bottom: 20%; }
    
    .top-right {
      right: 1%;
      top: 20%; }
    
    .center-up {
      right: 50%;
      top: 1%;
    }
    
    .center-down {
      right: 50%;
      bottom: 1%;
    }
    .canvas-image .canvas-caption p {
      text-align: center;
      padding-top: 0;
      padding: 0;
      -moz-transform: none;
      -webkit-transform: none;
      -o-transform: none;
      -ms-transform: none;
      transform: none;
      display: inline;
      position: absolute;
      background-color: rgba(0, 0, 0, 0.7);
      font-weight: bold;
      font-size: 58px;
      -webkit-box-shadow: 2px 2px 2px #000;
      -moz-box-shadow: 2px 2px 2px #000;
      box-shadow: 2px 2px 2px #000;
      padding: 1rem;
      color: white; }
    kbd.keyseq { color: #555555; }
    kbd:not(.keyseq) {
      display: inline-block;
      color: #222222;
      font-size: 0.7em;
      line-height: 1.4;
      background-color: #F7F7F7;
      border: 1px solid #ccc;
      -webkit-border-radius: 3px;
      border-radius: 3px;
      -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset;
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset;
      margin: -0.15em 0.15em 0 0.15em;
      padding: 0.2em 0.6em;
      vertical-align: middle;
      white-space: nowrap;
    }
    kbd kbd:first-child { margin-left: 0; }
    kbd kbd:last-child { margin-right: 0; }
  /*]]>*/
</style>
</body>
</html>